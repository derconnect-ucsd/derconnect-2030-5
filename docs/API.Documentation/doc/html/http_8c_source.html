<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EPRI 2030.5 Client: http.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EPRI 2030.5 Client
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('http_8c_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">http.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// author: Mark Slicker &lt;mark.slicker@gmail.com&gt;</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span>_HttpConnection HttpConnection;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">enum</span> HttpMethod {HTTP_GET, HTTP_PUT, HTTP_POST, HTTP_DELETE, HTTP_HEAD,</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;     HTTP_UNKNOWN, HTTP_RESPONSE, HTTP_NONE, HTTP_ERROR};</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno"><a class="line" href="group__http__connection.html#ga4242e44b555e915d598838a9b78ddbdf">   29</a></span>&#160;<span class="preprocessor">#define http_post(conn, buffer, uri)    \</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">  http_send (conn, buffer, uri, HTTP_POST)</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="group__http__connection.html#gae0780a5dd17b70dee776f2cf9a91a242">   35</a></span>&#160;<span class="preprocessor">#define http_put(conn, buffer, uri)     \</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">  http_send (conn, buffer, uri, HTTP_PUT)</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__http__connection.html#gaf3fe661f3848c3ce13c987c4f3f72ffb">http_init</a> (<span class="keywordtype">void</span> *conn, <span class="keywordtype">int</span> client, <span class="keyword">const</span> <span class="keywordtype">char</span> *accept, <span class="keyword">const</span> <span class="keywordtype">char</span> *media);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__http__connection.html#ga219c5661faaf31ba853fc7a4f4aaac07">http_flush</a> (<span class="keywordtype">void</span> *conn);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__http__connection.html#gad284834e20a26101fcd6e6751922c92e">http_write</a> (<span class="keywordtype">void</span> *conn, <span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> length);</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__http__connection.html#ga6d911522875a4b99a4172e4a02b78a8a">http_get</a> (<span class="keywordtype">void</span> *conn, <span class="keyword">const</span> <span class="keywordtype">char</span> *uri);</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__http__connection.html#ga9d3a703c0cf3b053e915eaec5b394c28">http_send</a> (<span class="keywordtype">void</span> *conn, <span class="keywordtype">char</span> *buffer, <span class="keyword">const</span> <span class="keywordtype">char</span> *uri, <span class="keywordtype">int</span> method);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__http__connection.html#ga81ef4c524a625b75de614b745300fd45">http_status_line</a> (<span class="keywordtype">char</span> *buffer, <span class="keywordtype">int</span> status, <span class="keyword">const</span> <span class="keywordtype">char</span> *reason);</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__http__connection.html#ga5b43c4092965e502da226511bb574b44">http_content</a> (<span class="keywordtype">char</span> *buffer, <span class="keyword">const</span> <span class="keywordtype">char</span> *media, <span class="keywordtype">int</span> length);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__http__connection.html#gaa36a00e63b21d521263da96cadd3ec44">set_content_length</a> (<span class="keywordtype">char</span> *buffer, <span class="keywordtype">int</span> length);</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__http__connection.html#ga83590f08e1aeaaa81b2873583ce99dd2">http_close</a> (<span class="keywordtype">void</span> *conn);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__http__connection.html#ga1aeb6fb256def5da05c835071e41dfa0">http_allow</a> (<span class="keywordtype">void</span> *conn, <span class="keyword">const</span> <span class="keywordtype">char</span> *allow);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__http__connection.html#gaa760070967803d689c4dd0fc407ff563">http_respond</a> (<span class="keywordtype">void</span> *conn, <span class="keywordtype">int</span> status);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__http__connection.html#ga81402c76a79e0fdf3f0fb8d4c9ba52e9">http_created</a> (<span class="keywordtype">void</span> *conn, <span class="keyword">const</span> <span class="keywordtype">char</span> *uri);</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__http__connection.html#ga48e49b5c445099537f9b9b4ae89fa8df">http_no_content</a> (<span class="keywordtype">void</span> *conn, <span class="keyword">const</span> <span class="keywordtype">char</span> *uri);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__http__connection.html#gac4613339c6810e44f79f8c4942ae9f6c">http_error</a> (<span class="keywordtype">void</span> *conn, <span class="keywordtype">int</span> status);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__http__connection.html#ga8573192ee45dd0e3a5111bab62e03e44">http_receive</a> (<span class="keywordtype">void</span> *conn);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__http__connection.html#ga92f8776c838fb93b9ea9aedfc665a694">http_body</a> (<span class="keywordtype">void</span> *conn);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="keywordtype">char</span> *<a class="code" href="group__http__connection.html#gaa572f95189ccc118a8fc1d070b76f896">http_data</a> (<span class="keywordtype">void</span> *conn, <span class="keywordtype">int</span> *length);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__http__connection.html#ga5150a5e062ed872568f6666ce8859baa">http_rebuffer</a> (<span class="keywordtype">void</span> *conn, <span class="keywordtype">char</span> *data);</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__http__connection.html#ga840e20735c835fbd29956a2d82b5ef71">http_complete</a> (<span class="keywordtype">void</span> *conn);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__http__connection.html#gaab725405e3c788f0b9b72d3a3cc5d2f3">http_status</a> (<span class="keywordtype">void</span> *conn);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__http__connection.html#ga588ce3ea3e16dab03a96b65b9d58d0dc">http_method</a> (<span class="keywordtype">void</span> *conn);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="keywordtype">char</span> *<a class="code" href="group__http__connection.html#ga8cf07b868935828ebfe2b80c8b3d135e">http_path</a> (<span class="keywordtype">void</span> *conn);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="keywordtype">char</span> *<a class="code" href="group__http__connection.html#gae61eeb371ab52758dcdc2e376c32d7c1">http_query</a> (<span class="keywordtype">void</span> *conn);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="keywordtype">char</span> *<a class="code" href="group__http__connection.html#ga5e069d5d6ad16d184f959507c7e3bea8">http_range</a> (<span class="keywordtype">void</span> *conn);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__http__connection.html#gad00b80f2f0573963fb7f6f0227fc748a">http_client</a> (<span class="keywordtype">void</span> *conn);</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="keywordtype">char</span> *<a class="code" href="group__http__connection.html#gaf4fb8bd1fa38b29e340be73efac05a40">http_location</a> (<span class="keywordtype">void</span> *conn);</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__http__connection.html#ga08146812d01ea110926efc6dbf39b91d">http_parse_uri</a> (<a class="code" href="structUri.html">Uri</a> *uri, <span class="keywordtype">void</span> *conn, <span class="keyword">const</span> <span class="keywordtype">char</span> *href);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="preprocessor">#ifndef HEADER_ONLY</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="preprocessor">#include &lt;time.h&gt;</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="keyword">enum</span> HttpState {HTTP_START, HTTP_HEADER, HTTP_DATA, HTTP_COMPLETE, HTTP_CLOSED};</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> http_methods[] =</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  {<span class="stringliteral">&quot;GET&quot;</span>, <span class="stringliteral">&quot;PUT&quot;</span>, <span class="stringliteral">&quot;POST&quot;</span>, <span class="stringliteral">&quot;DELETE&quot;</span>, <span class="stringliteral">&quot;HEAD&quot;</span>, <span class="stringliteral">&quot;&quot;</span>};</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span>_SendQueueItem {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="keyword">struct </span>_SendQueueItem *next;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="keywordtype">int</span> length;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="keywordtype">char</span> buffer[];</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;} SendQueueItem;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span>_HttpRequest {</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="keyword">struct </span>_HttpRequest *next;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  uint8_t method; <span class="keywordtype">char</span> uri[];</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;} HttpRequest;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">// An HTTP connection uses a fixed length buffer</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">// make sure buffer is large enough for the request/status + headers</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="preprocessor">#define BUFFER_SIZE 2048</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span>_HttpConnection {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  Connection tcp;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keywordtype">char</span> *query, *content_type, *media_range, *location;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <a class="code" href="group__address.html#ga80f2dcdb3778441e85ac8c9dbb6f324a">Address</a> host; <span class="comment">// host from the Host: header field</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="keywordtype">char</span> *headers, *version;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *media; <span class="comment">// media type for POST/PUT</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *accept; <span class="comment">// media types accepted</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keywordtype">char</span> *data; <span class="comment">// pointer to the next header line or http content</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <span class="keywordtype">int</span> end;    <span class="comment">// buffer + end = the end of the http message</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <span class="keywordtype">int</span> length; <span class="comment">// the amount of data in buffer</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <span class="keywordtype">int</span> content_length; <span class="comment">// from the Content-Length header</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  uint8_t state, method, request_method;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keywordtype">unsigned</span> body : 1; <span class="comment">// response or request has a body</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordtype">unsigned</span> close : 1; <span class="comment">// close signaled in last request/response</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="keywordtype">unsigned</span> client : 1; <span class="comment">// true for client connection</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keywordtype">int</span> status, error, header;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <a class="code" href="structQueue.html">Queue</a> send, request;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="keywordtype">char</span> target[256]; <a class="code" href="structUri.html">Uri</a> uri; <span class="comment">// request target</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="keywordtype">char</span> buffer[BUFFER_SIZE];</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;} HttpConnection;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="preprocessor">#define buffer_full(h) (((h)-&gt;length+1) == BUFFER_SIZE)</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="preprocessor">#include &quot;http_parse.c&quot;</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="preprocessor">#define http_field(conn, name) struct_field (HttpConnection, conn, name)</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno"><a class="line" href="group__http__connection.html#ga92f8776c838fb93b9ea9aedfc665a694">  293</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__http__connection.html#ga92f8776c838fb93b9ea9aedfc665a694">http_body</a> (<span class="keywordtype">void</span> *conn) { <span class="keywordflow">return</span> http_field (conn, body); }</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="keywordtype">int</span> http_content_length (<span class="keywordtype">void</span> *conn) {</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="keywordflow">return</span> http_field (conn, content_length); }</div><div class="line"><a name="l00296"></a><span class="lineno"><a class="line" href="group__http__connection.html#gaab725405e3c788f0b9b72d3a3cc5d2f3">  296</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__http__connection.html#gaab725405e3c788f0b9b72d3a3cc5d2f3">http_status</a> (<span class="keywordtype">void</span> *conn) { <span class="keywordflow">return</span> http_field (conn, status); }</div><div class="line"><a name="l00297"></a><span class="lineno"><a class="line" href="group__http__connection.html#ga588ce3ea3e16dab03a96b65b9d58d0dc">  297</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__http__connection.html#ga588ce3ea3e16dab03a96b65b9d58d0dc">http_method</a> (<span class="keywordtype">void</span> *conn) { <span class="keywordflow">return</span> http_field (conn, request_method); }</div><div class="line"><a name="l00298"></a><span class="lineno"><a class="line" href="group__http__connection.html#ga8cf07b868935828ebfe2b80c8b3d135e">  298</a></span>&#160;<span class="keywordtype">char</span> *<a class="code" href="group__http__connection.html#ga8cf07b868935828ebfe2b80c8b3d135e">http_path</a> (<span class="keywordtype">void</span> *conn) { <span class="keywordflow">return</span> http_field (conn, uri.path); }</div><div class="line"><a name="l00299"></a><span class="lineno"><a class="line" href="group__http__connection.html#gae61eeb371ab52758dcdc2e376c32d7c1">  299</a></span>&#160;<span class="keywordtype">char</span> *<a class="code" href="group__http__connection.html#gae61eeb371ab52758dcdc2e376c32d7c1">http_query</a> (<span class="keywordtype">void</span> *conn) { <span class="keywordflow">return</span> http_field (conn, uri.query); }</div><div class="line"><a name="l00300"></a><span class="lineno"><a class="line" href="group__http__connection.html#ga5e069d5d6ad16d184f959507c7e3bea8">  300</a></span>&#160;<span class="keywordtype">char</span> *<a class="code" href="group__http__connection.html#ga5e069d5d6ad16d184f959507c7e3bea8">http_range</a> (<span class="keywordtype">void</span> *conn) { <span class="keywordflow">return</span> http_field (conn, media_range); }</div><div class="line"><a name="l00301"></a><span class="lineno"><a class="line" href="group__http__connection.html#gad00b80f2f0573963fb7f6f0227fc748a">  301</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__http__connection.html#gad00b80f2f0573963fb7f6f0227fc748a">http_client</a> (<span class="keywordtype">void</span> *conn) { <span class="keywordflow">return</span> http_field (conn, client); }</div><div class="line"><a name="l00302"></a><span class="lineno"><a class="line" href="group__http__connection.html#gaf4fb8bd1fa38b29e340be73efac05a40">  302</a></span>&#160;<span class="keywordtype">char</span> *<a class="code" href="group__http__connection.html#gaf4fb8bd1fa38b29e340be73efac05a40">http_location</a> (<span class="keywordtype">void</span> *conn) { <span class="keywordflow">return</span> http_field (conn, location); }</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="keywordtype">void</span> print_http_status (<span class="keywordtype">void</span> *conn) { HttpConnection *c = conn;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *method = http_methods[c-&gt;request_method];</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  printf (<span class="stringliteral">&quot;%s %s: %d\n&quot;</span>, method, c-&gt;uri.path, c-&gt;status);  </div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;}</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div><div class="line"><a name="l00309"></a><span class="lineno"><a class="line" href="group__http__connection.html#gaf3fe661f3848c3ce13c987c4f3f72ffb">  309</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__http__connection.html#gaf3fe661f3848c3ce13c987c4f3f72ffb">http_init</a> (<span class="keywordtype">void</span> *conn, <span class="keywordtype">int</span> client,</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *accept,</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *media) {</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  HttpConnection *c = conn;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  c-&gt;client = client;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  c-&gt;data = c-&gt;buffer;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  c-&gt;accept = accept;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  c-&gt;media = media;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  c-&gt;version = <span class="stringliteral">&quot;HTTP/1.1&quot;</span>;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  c-&gt;headers = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;}</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno"><a class="line" href="group__http__connection.html#ga219c5661faaf31ba853fc7a4f4aaac07">  321</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__http__connection.html#ga219c5661faaf31ba853fc7a4f4aaac07">http_flush</a> (<span class="keywordtype">void</span> *conn) {</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  HttpConnection *h = conn; SendQueueItem *t, *i;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <span class="keywordflow">while</span> ((i = <a class="code" href="group__queue.html#gab4e9f523209630c13dec04655bfacc49">queue_peek</a> (&amp;h-&gt;send))</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;   &amp;&amp; <a class="code" href="group__connection.html#gae63df32b30da421837e2c67cfacc3497">conn_write</a> (conn, i-&gt;buffer, i-&gt;length) &gt; 0)</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    free (<a class="code" href="group__queue.html#ga5f39cda20a9848df6e23aada641f5461">queue_remove</a> (&amp;h-&gt;send));</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group__queue.html#ga3001011f0b018b23ce87b33bbc6438d9">queue_empty</a> (&amp;h-&gt;send) &amp;&amp; h-&gt;close) <a class="code" href="group__connection.html#gada463d4dd44545e50cd269a5c363787d">conn_close</a> (h);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;}</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00329"></a><span class="lineno"><a class="line" href="group__http__connection.html#gad284834e20a26101fcd6e6751922c92e">  329</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__http__connection.html#gad284834e20a26101fcd6e6751922c92e">http_write</a> (<span class="keywordtype">void</span> *conn, <span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> length) {</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  HttpConnection *h = conn;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="keywordflow">if</span> (h-&gt;send.first || <a class="code" href="group__connection.html#gae63df32b30da421837e2c67cfacc3497">conn_write</a> (conn, data, length) &lt; 0) {</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    SendQueueItem *i = malloc (<span class="keyword">sizeof</span> (SendQueueItem) + length);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    i-&gt;length = length; i-&gt;next = NULL;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    memcpy (i-&gt;buffer, data, length);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <a class="code" href="group__queue.html#gaaa24b65f3154f21e3ff86ef0722b5c33">queue_insert</a> (&amp;h-&gt;send, i);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  }</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;}</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="keywordtype">void</span> queue_request (HttpConnection *c, <span class="keywordtype">int</span> method, <span class="keyword">const</span> <span class="keywordtype">char</span> *uri) {</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  HttpRequest *r = malloc (<span class="keyword">sizeof</span> (HttpRequest) + strlen (uri) + 1);</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  r-&gt;next = NULL; r-&gt;method = method; strcpy (r-&gt;uri, uri);</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <a class="code" href="group__queue.html#gaaa24b65f3154f21e3ff86ef0722b5c33">queue_insert</a> (&amp;c-&gt;request, r);</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;}</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;HttpRequest *dequeue_request (HttpConnection *c) {</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__queue.html#ga5f39cda20a9848df6e23aada641f5461">queue_remove</a> (&amp;c-&gt;request);</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;}</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="keywordtype">int</span> http_request (<span class="keywordtype">void</span> *conn, <span class="keywordtype">char</span> *buffer, <span class="keyword">const</span> <span class="keywordtype">char</span> *uri, <span class="keywordtype">int</span> method) {</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  HttpConnection *c = conn; <span class="keyword">const</span> <span class="keywordtype">char</span> *name = http_methods[method];</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="keywordtype">int</span> n = sprintf (buffer, <span class="stringliteral">&quot;%s %s %s\r\nHost: &quot;</span>, name, uri, c-&gt;version);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  n += write_address_port (buffer+n, <a class="code" href="group__tcp.html#gafcf36036563f4bf40b5ec38752b29391">tcp_host</a> (c));</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  n += sprintf (buffer+n, <span class="stringliteral">&quot;\r\nAccept: %s\r\n&quot;</span>, c-&gt;accept);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  queue_request (conn, method, uri); <span class="keywordflow">return</span> n;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;}</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div><div class="line"><a name="l00357"></a><span class="lineno"><a class="line" href="group__http__connection.html#ga6d911522875a4b99a4172e4a02b78a8a">  357</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__http__connection.html#ga6d911522875a4b99a4172e4a02b78a8a">http_get</a> (<span class="keywordtype">void</span> *conn, <span class="keyword">const</span> <span class="keywordtype">char</span> *uri) { <span class="keywordtype">char</span> buffer[256];</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="keywordtype">int</span> n = http_request (conn, buffer, uri, HTTP_GET);</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  printf (<span class="stringliteral">&quot;http_get %s\n&quot;</span>, uri);</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  n += sprintf (buffer+n, <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <a class="code" href="group__http__connection.html#gad284834e20a26101fcd6e6751922c92e">http_write</a> (conn, buffer, n);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;}</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno"><a class="line" href="group__http__connection.html#ga5b43c4092965e502da226511bb574b44">  364</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__http__connection.html#ga5b43c4092965e502da226511bb574b44">http_content</a> (<span class="keywordtype">char</span> *buffer, <span class="keyword">const</span> <span class="keywordtype">char</span> *media, <span class="keywordtype">int</span> length) {</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="keywordtype">int</span> n = sprintf (buffer, <span class="stringliteral">&quot;Content-Type: %s\r\n&quot;</span>, media);</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  n += sprintf (buffer+n, <span class="stringliteral">&quot;Content-Length: %-6d\r\n\r\n&quot;</span>, length);</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="keywordflow">return</span> n;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;}</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno"><a class="line" href="group__http__connection.html#ga9d3a703c0cf3b053e915eaec5b394c28">  370</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__http__connection.html#ga9d3a703c0cf3b053e915eaec5b394c28">http_send</a> (<span class="keywordtype">void</span> *conn, <span class="keywordtype">char</span> *buffer, <span class="keyword">const</span> <span class="keywordtype">char</span> *uri, <span class="keywordtype">int</span> method) {</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  HttpConnection *c = conn;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <span class="keywordtype">int</span> n = http_request (conn, buffer, uri, method);</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <span class="keywordflow">return</span> n + <a class="code" href="group__http__connection.html#ga5b43c4092965e502da226511bb574b44">http_content</a> (buffer+n, c-&gt;media, 0);</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;}</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div><div class="line"><a name="l00376"></a><span class="lineno"><a class="line" href="group__http__connection.html#gaa36a00e63b21d521263da96cadd3ec44">  376</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__http__connection.html#gaa36a00e63b21d521263da96cadd3ec44">set_content_length</a> (<span class="keywordtype">char</span> *buffer, <span class="keywordtype">int</span> length) {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="keywordtype">char</span> *field = strstr (buffer, <span class="stringliteral">&quot;Content-Length:&quot;</span>) + 16;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  field += sprintf (field, <span class="stringliteral">&quot;%d&quot;</span>, length); *field = <span class="charliteral">&#39; &#39;</span>;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;}</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div><div class="line"><a name="l00381"></a><span class="lineno"><a class="line" href="group__http__connection.html#ga83590f08e1aeaaa81b2873583ce99dd2">  381</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__http__connection.html#ga83590f08e1aeaaa81b2873583ce99dd2">http_close</a> (<span class="keywordtype">void</span> *conn) {</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  HttpConnection *h = conn;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  printf (<span class="stringliteral">&quot;http_close\n&quot;</span>);</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <a class="code" href="group__queue.html#ga42c7cc8caeb6778234887511db8fba40">queue_free</a> (&amp;h-&gt;send); <a class="code" href="group__queue.html#ga42c7cc8caeb6778234887511db8fba40">queue_free</a> (&amp;h-&gt;request);</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <a class="code" href="group__connection.html#gada463d4dd44545e50cd269a5c363787d">conn_close</a> (h); h-&gt;state = HTTP_CLOSED;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;}</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div><div class="line"><a name="l00388"></a><span class="lineno"><a class="line" href="group__http__connection.html#ga81ef4c524a625b75de614b745300fd45">  388</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__http__connection.html#ga81ef4c524a625b75de614b745300fd45">http_status_line</a> (<span class="keywordtype">char</span> *buffer, <span class="keywordtype">int</span> status, <span class="keyword">const</span> <span class="keywordtype">char</span> *reason) {</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keywordtype">int</span> n = sprintf (buffer, <span class="stringliteral">&quot;HTTP/1.1 %d %s\r\n&quot;</span>, status, reason);</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  time_t now = time (NULL); <span class="keyword">struct </span>tm tm = *gmtime (&amp;now);</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  n += strftime (buffer+n, 1024, <span class="stringliteral">&quot;Date: %a, %d %b %Y %H:%M:%S GMT\r\n&quot;</span>, &amp;tm);</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="keywordflow">return</span> n;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;}</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno"><a class="line" href="group__http__connection.html#ga81402c76a79e0fdf3f0fb8d4c9ba52e9">  395</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__http__connection.html#ga81402c76a79e0fdf3f0fb8d4c9ba52e9">http_created</a> (<span class="keywordtype">void</span> *conn, <span class="keyword">const</span> <span class="keywordtype">char</span> *uri) { <span class="keywordtype">char</span> buffer[512];</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <span class="keywordtype">int</span> n = <a class="code" href="group__http__connection.html#ga81ef4c524a625b75de614b745300fd45">http_status_line</a> (buffer, 201, <span class="stringliteral">&quot;Created&quot;</span>);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  n += sprintf (buffer+n, <span class="stringliteral">&quot;Content-Length: 0\r\nLocation: %s\r\n\r\n&quot;</span>, uri);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <a class="code" href="group__http__connection.html#gad284834e20a26101fcd6e6751922c92e">http_write</a> (conn, buffer, n);</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;}</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno"><a class="line" href="group__http__connection.html#ga48e49b5c445099537f9b9b4ae89fa8df">  401</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__http__connection.html#ga48e49b5c445099537f9b9b4ae89fa8df">http_no_content</a> (<span class="keywordtype">void</span> *conn, <span class="keyword">const</span> <span class="keywordtype">char</span> *uri) { <span class="keywordtype">char</span> buffer[512];</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <span class="keywordtype">int</span> n = <a class="code" href="group__http__connection.html#ga81ef4c524a625b75de614b745300fd45">http_status_line</a> (buffer, 204, <span class="stringliteral">&quot;No Content&quot;</span>);</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  n += sprintf (buffer+n, <span class="stringliteral">&quot;Location: %s\r\n\r\n&quot;</span>, uri);</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <a class="code" href="group__http__connection.html#gad284834e20a26101fcd6e6751922c92e">http_write</a> (conn, buffer, n);</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;}</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00407"></a><span class="lineno"><a class="line" href="group__http__connection.html#ga1aeb6fb256def5da05c835071e41dfa0">  407</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__http__connection.html#ga1aeb6fb256def5da05c835071e41dfa0">http_allow</a> (<span class="keywordtype">void</span> *conn, <span class="keyword">const</span> <span class="keywordtype">char</span> *allow) { <span class="keywordtype">char</span> buffer[512];</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="keywordtype">int</span> n = <a class="code" href="group__http__connection.html#ga81ef4c524a625b75de614b745300fd45">http_status_line</a> (buffer, 405, <span class="stringliteral">&quot;Method Not Allowed&quot;</span>);</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  n += sprintf (buffer+n, <span class="stringliteral">&quot;Allow: %s\r\n\r\n&quot;</span>, allow);</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <a class="code" href="group__http__connection.html#gad284834e20a26101fcd6e6751922c92e">http_write</a> (conn, buffer, n);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;}</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *http_reason (<span class="keywordtype">int</span> status) {</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <span class="keywordflow">switch</span> (status) {</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keywordflow">case</span> 400: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Bad Request&quot;</span>;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <span class="keywordflow">case</span> 403: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Forbidden&quot;</span>;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="keywordflow">case</span> 404: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Not Found&quot;</span>;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <span class="keywordflow">case</span> 405: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Method Not Allowed&quot;</span>;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="keywordflow">case</span> 408: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Request Timeout&quot;</span>;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="keywordflow">case</span> 406: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Not Acceptable&quot;</span>;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="keywordflow">case</span> 415: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unsupported Media Type&quot;</span>;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  <span class="keywordflow">case</span> 500: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Internal Server Error&quot;</span>;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="keywordflow">default</span>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  }</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;}</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno"><a class="line" href="group__http__connection.html#gaa760070967803d689c4dd0fc407ff563">  427</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__http__connection.html#gaa760070967803d689c4dd0fc407ff563">http_respond</a> (<span class="keywordtype">void</span> *conn, <span class="keywordtype">int</span> status) { <span class="keywordtype">char</span> buffer[512];</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *reason = http_reason (status);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="keywordtype">int</span> n = <a class="code" href="group__http__connection.html#ga81ef4c524a625b75de614b745300fd45">http_status_line</a> (buffer, status, reason);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  n += sprintf (buffer+n, <span class="stringliteral">&quot;Content-Length: 0\r\n\r\n&quot;</span>);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <a class="code" href="group__http__connection.html#gad284834e20a26101fcd6e6751922c92e">http_write</a> (conn, buffer, n);</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;}</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">// fatal error, send status and close connection</span></div><div class="line"><a name="l00435"></a><span class="lineno"><a class="line" href="group__http__connection.html#gac4613339c6810e44f79f8c4942ae9f6c">  435</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__http__connection.html#gac4613339c6810e44f79f8c4942ae9f6c">http_error</a> (<span class="keywordtype">void</span> *conn, <span class="keywordtype">int</span> status) {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  printf (<span class="stringliteral">&quot;http_error %x %d\n&quot;</span>, conn, status); fflush (stdout);</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <a class="code" href="group__http__connection.html#gaa760070967803d689c4dd0fc407ff563">http_respond</a> (conn, status); <a class="code" href="group__http__connection.html#ga83590f08e1aeaaa81b2873583ce99dd2">http_close</a> (conn);</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;}</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="keywordtype">int</span> http_read (<span class="keywordtype">void</span> *conn) {</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  HttpConnection *h = conn;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <span class="keywordtype">int</span> n = <a class="code" href="group__connection.html#ga8b841fbab5b0a476ce2d8bf8a05ecbcd">conn_read</a> (conn, h-&gt;buffer+h-&gt;length,</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;         BUFFER_SIZE-h-&gt;length-1);</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <span class="comment">//  printf (&quot;http_read %d\n&quot;, n);</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <span class="keywordflow">if</span> (n &lt;= 0) <span class="keywordflow">return</span> n;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  h-&gt;length += n;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  h-&gt;buffer[h-&gt;length] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  <span class="comment">//  printf (h-&gt;buffer); fflush (stdout);</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="keywordflow">return</span> n;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;}</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno"><a class="line" href="group__http__connection.html#ga840e20735c835fbd29956a2d82b5ef71">  452</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__http__connection.html#ga840e20735c835fbd29956a2d82b5ef71">http_complete</a> (<span class="keywordtype">void</span> *conn) { HttpConnection *c = conn;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="keywordflow">return</span> c-&gt;state == HTTP_CLOSED || c-&gt;end &lt;= c-&gt;length;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;}</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">// return data associated with HTTP message</span></div><div class="line"><a name="l00457"></a><span class="lineno"><a class="line" href="group__http__connection.html#gaa572f95189ccc118a8fc1d070b76f896">  457</a></span>&#160;<span class="keywordtype">char</span> *<a class="code" href="group__http__connection.html#gaa572f95189ccc118a8fc1d070b76f896">http_data</a> (<span class="keywordtype">void</span> *conn, <span class="keywordtype">int</span> *length) {</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  HttpConnection *c = conn;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="keywordflow">if</span> (c-&gt;state != HTTP_DATA) <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160; top:</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="keywordflow">if</span> (c-&gt;close) {</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__tcp.html#ga4e3db9ca684fe6b75e37dae88f3aeac4">tcp_status</a> (c) == <a class="code" href="group__tcp.html#ggad2e85a3151cfb7e79fcba1dc40813da1a30c0b4dad1e3a3b93f822b9cef26244b">Closed</a>) c-&gt;state++; <span class="comment">// HTTP_COMPLETE</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    http_read (c); *length = c-&gt;length;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c-&gt;end &lt;= c-&gt;length) {</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    *length = c-&gt;end; c-&gt;state++; <span class="comment">// HTTP_COMPLETE</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!buffer_full (c) &amp;&amp; http_read (c) &gt; 0)</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="keywordflow">goto</span> top;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="keywordflow">else</span> *length = c-&gt;length;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  *length -= c-&gt;data - c-&gt;buffer;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="keywordflow">return</span> c-&gt;data;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;}                </div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno"><a class="line" href="group__http__connection.html#ga5150a5e062ed872568f6666ce8859baa">  473</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__http__connection.html#ga5150a5e062ed872568f6666ce8859baa">http_rebuffer</a> (<span class="keywordtype">void</span> *conn, <span class="keywordtype">char</span> *data) {</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  HttpConnection *c = conn; <span class="keywordtype">int</span> n;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="keywordflow">if</span> (n = data - c-&gt;buffer) {</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keywordflow">if</span> (c-&gt;end) c-&gt;end -= n;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    c-&gt;length -= n; c-&gt;data = c-&gt;buffer;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    memmove (c-&gt;buffer, data, c-&gt;length+1);</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  }</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;}</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">// return next complete line in message or NULL</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="keywordtype">char</span> *next_line (HttpConnection *h) {</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="keywordtype">int</span> c; <span class="keywordtype">char</span> *data = h-&gt;data;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; top:</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="keywordflow">while</span> ((c = *data)) {</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;\r&#39;</span> &amp;&amp; *(data+1) == <span class="charliteral">&#39;\n&#39;</span>) {</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      *data = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      <span class="keywordflow">return</span> data+2;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    }</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    data++;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  } <span class="keywordflow">if</span> (http_read (h) &gt; 0) <span class="keywordflow">goto</span> top;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <span class="keywordflow">if</span> (data != h-&gt;data || h-&gt;state != HTTP_START)</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    set_timeout (h);</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;}</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">// header flags</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="preprocessor">#define HTTP_HOST 1</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="preprocessor">#define HTTP_ACCEPT 2</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="preprocessor">#define HTTP_CONTENT_TYPE 4</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="preprocessor">#define HTTP_CONTENT_LENGTH 8</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="preprocessor">#define HTTP_CONNECTION 16</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="preprocessor">#define HTTP_LOCATION 32</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment">// receive an HTTP message</span></div><div class="line"><a name="l00507"></a><span class="lineno"><a class="line" href="group__http__connection.html#ga8573192ee45dd0e3a5111bab62e03e44">  507</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__http__connection.html#ga8573192ee45dd0e3a5111bab62e03e44">http_receive</a> (<span class="keywordtype">void</span> *conn) {</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  HttpConnection *c = conn; HttpRequest *r; <a class="code" href="structUri.html">Uri</a> uri; <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> headers[] = {<span class="stringliteral">&quot;host&quot;</span>, <span class="stringliteral">&quot;accept&quot;</span>, <span class="stringliteral">&quot;content-type&quot;</span>,</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;          <span class="stringliteral">&quot;content-length&quot;</span>, <span class="stringliteral">&quot;connection&quot;</span>,</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;          <span class="stringliteral">&quot;location&quot;</span>}; </div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  <span class="keywordtype">char</span> *header, *method, *target, *token, *data, *next;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="keywordflow">while</span> (1) {</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keywordflow">switch</span> (c-&gt;state) {</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordflow">case</span> HTTP_START: <span class="comment">// request/status line</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      ok_v (next = next_line (c), HTTP_NONE); data = c-&gt;data;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      <span class="keywordflow">if</span> (*data == <span class="charliteral">&#39;\0&#39;</span>) <span class="keywordflow">break</span>; <span class="comment">// allow empty lines to start</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      c-&gt;close = c-&gt;end = c-&gt;header = c-&gt;error;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      c-&gt;content_type = c-&gt;media_range = NULL; c-&gt;body = 1;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      c-&gt;content_length = -1;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      <span class="keywordflow">if</span> (!(data = token_sp (&amp;method, data))) <span class="keywordflow">goto</span> close;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <span class="keywordflow">if</span> (c-&gt;client) {</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="keywordflow">if</span> (streq (method, c-&gt;version) <span class="comment">// status line</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      &amp;&amp; (data = token_sp (&amp;token, data))</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      &amp;&amp; number (&amp;c-&gt;status, token)</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      &amp;&amp; c-&gt;status &lt;= 999</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      &amp;&amp; (r = dequeue_request (c))</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      &amp;&amp; request_target (c, r-&gt;uri)) </div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    c-&gt;method = HTTP_RESPONSE;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">goto</span> close;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  c-&gt;request_method = r-&gt;method; free (r);</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((data = token_sp (&amp;target, data))</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;     &amp;&amp; request_target (c, target)</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;     &amp;&amp; streq (data, <span class="stringliteral">&quot;HTTP/1.1&quot;</span>)) { <span class="comment">// request line</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  c-&gt;request_method = c-&gt;method = string_index (method, http_methods, 5);</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      } <span class="keywordflow">else</span> { <a class="code" href="group__http__connection.html#gac4613339c6810e44f79f8c4942ae9f6c">http_error</a> (c, 400); <span class="keywordflow">return</span> HTTP_ERROR; }</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      c-&gt;state++; <span class="keywordflow">break</span>;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keywordflow">case</span> HTTP_HEADER:</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      ok_v (next = next_line (c), HTTP_NONE); data = c-&gt;data;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      <span class="keywordflow">switch</span> (*data) {</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;\0&#39;</span>: <span class="comment">// end of headers</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="keywordflow">if</span> (c-&gt;error) {</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="keywordflow">if</span> (c-&gt;method == HTTP_RESPONSE) <span class="keywordflow">goto</span> close;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <a class="code" href="group__http__connection.html#gac4613339c6810e44f79f8c4942ae9f6c">http_error</a> (c, c-&gt;error); <span class="keywordflow">return</span> HTTP_ERROR;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  }</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <span class="keywordflow">if</span> ((c-&gt;method == HTTP_RESPONSE</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;       &amp;&amp; ((c-&gt;header &amp; HTTP_CONTENT_LENGTH &amp;&amp; !c-&gt;end)</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;     || ((c-&gt;status &gt;= 100 &amp;&amp; c-&gt;status &lt;= 199)</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;         || c-&gt;status == 204 || c-&gt;status == 304)))</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;       || (c-&gt;method != HTTP_RESPONSE &amp;&amp; !c-&gt;end)) {</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="comment">// response or request with no body</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    c-&gt;body = 0; c-&gt;state = HTTP_COMPLETE;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  } <span class="keywordflow">else</span> { c-&gt;state++; <span class="comment">// HTTP_DATA</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordflow">if</span> (!c-&gt;end) c-&gt;close = 1; <span class="comment">// close-delimited message</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  }</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  c-&gt;end += next - c-&gt;buffer; <span class="comment">// message end  </span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  c-&gt;data = next;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <span class="keywordflow">return</span> c-&gt;method;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39; &#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;\t&#39;</span>: c-&gt;error = 400; <span class="keywordflow">break</span>; <span class="comment">// obsolete line folding</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="keywordflow">if</span> (!(data = token_colon (&amp;header, data))) {</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    c-&gt;error = 400; <span class="keywordflow">break</span>;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  }</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  i = string_index (to_lower (header), headers, 6); c-&gt;header |= 1 &lt;&lt; i;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="keywordflow">switch</span> (i) {</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="keywordflow">case</span> 0: <span class="comment">// Host</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    data = ows (parse_host (&amp;uri, &amp;c-&gt;<a class="code" href="structUri.html#a8c55d8f97378d3d64fe6d578fa5eb172">host</a>, data));</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="keywordflow">if</span> (*data != <span class="charliteral">&#39;\0&#39;</span>) c-&gt;error = 400; <span class="keywordflow">break</span>;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <span class="keywordflow">case</span> 1: <span class="comment">// Accept</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    c-&gt;media_range = data; <span class="keywordflow">break</span>;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="keywordflow">case</span> 2: <span class="comment">// Content-Type</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    c-&gt;content_type = data; <span class="keywordflow">break</span>;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  <span class="keywordflow">case</span> 3: <span class="comment">// Content-Length</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    data = ows (number (&amp;c-&gt;end, data));</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="keywordflow">if</span> (data &amp;&amp; *data == <span class="charliteral">&#39;\0&#39;</span>)</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      c-&gt;content_length = c-&gt;end;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordflow">else</span> c-&gt;error = 400; <span class="keywordflow">break</span>;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <span class="keywordflow">case</span> 4: <span class="comment">// Connection</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    c-&gt;close = streq (to_lower (data), <span class="stringliteral">&quot;close&quot;</span>); <span class="keywordflow">break</span>;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  <span class="keywordflow">case</span> 5: <span class="comment">// Location</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    c-&gt;location = data;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  }</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      } <span class="keywordflow">break</span>;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keywordflow">case</span> HTTP_DATA: <span class="keywordflow">return</span> c-&gt;method;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="keywordflow">case</span> HTTP_COMPLETE:</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      <span class="keywordflow">if</span> (!c-&gt;close) {</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  <a class="code" href="group__http__connection.html#ga5150a5e062ed872568f6666ce8859baa">http_rebuffer</a> (c, c-&gt;buffer + c-&gt;end);</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  c-&gt;state = HTTP_START; <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      } c-&gt;state++;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordflow">case</span> HTTP_CLOSED:</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      <span class="keywordflow">return</span> HTTP_NONE;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    }</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    c-&gt;data = next;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  }</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160; close:</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  <a class="code" href="group__http__connection.html#ga83590f08e1aeaaa81b2873583ce99dd2">http_close</a> (c); <span class="keywordflow">return</span> HTTP_NONE;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;}</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="preprocessor">#endif</span></div><div class="ttc" id="structUri_html_a8c55d8f97378d3d64fe6d578fa5eb172"><div class="ttname"><a href="structUri.html#a8c55d8f97378d3d64fe6d578fa5eb172">Uri::host</a></div><div class="ttdeci">Address * host</div><div class="ttdef"><b>Definition:</b> <a href="uri_8c_source.html#l00015">uri.c:15</a></div></div>
<div class="ttc" id="group__connection_html_ga8b841fbab5b0a476ce2d8bf8a05ecbcd"><div class="ttname"><a href="group__connection.html#ga8b841fbab5b0a476ce2d8bf8a05ecbcd">conn_read</a></div><div class="ttdeci">int conn_read(void *conn, char *buffer, int size)</div><div class="ttdoc">Read data from a Connection. </div><div class="ttdef"><b>Definition:</b> <a href="connection_8c_source.html#l00111">connection.c:111</a></div></div>
<div class="ttc" id="group__queue_html_ga5f39cda20a9848df6e23aada641f5461"><div class="ttname"><a href="group__queue.html#ga5f39cda20a9848df6e23aada641f5461">queue_remove</a></div><div class="ttdeci">void * queue_remove(Queue *queue)</div><div class="ttdoc">Remove linked item from the head of the queue. </div><div class="ttdef"><b>Definition:</b> <a href="queue_8c_source.html#l00056">queue.c:56</a></div></div>
<div class="ttc" id="group__queue_html_gab4e9f523209630c13dec04655bfacc49"><div class="ttname"><a href="group__queue.html#gab4e9f523209630c13dec04655bfacc49">queue_peek</a></div><div class="ttdeci">#define queue_peek(queue)</div><div class="ttdoc">Return the head of the queue without removing it. </div><div class="ttdef"><b>Definition:</b> <a href="queue_8c_source.html#l00016">queue.c:16</a></div></div>
<div class="ttc" id="group__http__connection_html_ga5b43c4092965e502da226511bb574b44"><div class="ttname"><a href="group__http__connection.html#ga5b43c4092965e502da226511bb574b44">http_content</a></div><div class="ttdeci">int http_content(char *buffer, const char *media, int length)</div><div class="ttdoc">Write HTTP content headers to a buffer. </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00364">http.c:364</a></div></div>
<div class="ttc" id="group__http__connection_html_ga92f8776c838fb93b9ea9aedfc665a694"><div class="ttname"><a href="group__http__connection.html#ga92f8776c838fb93b9ea9aedfc665a694">http_body</a></div><div class="ttdeci">int http_body(void *conn)</div><div class="ttdoc">Does the HTTP message have a body? </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00293">http.c:293</a></div></div>
<div class="ttc" id="group__tcp_html_ggad2e85a3151cfb7e79fcba1dc40813da1a30c0b4dad1e3a3b93f822b9cef26244b"><div class="ttname"><a href="group__tcp.html#ggad2e85a3151cfb7e79fcba1dc40813da1a30c0b4dad1e3a3b93f822b9cef26244b">Closed</a></div><div class="ttdef"><b>Definition:</b> <a href="platform_8c_source.html#l00177">platform.c:177</a></div></div>
<div class="ttc" id="group__http__connection_html_ga9d3a703c0cf3b053e915eaec5b394c28"><div class="ttname"><a href="group__http__connection.html#ga9d3a703c0cf3b053e915eaec5b394c28">http_send</a></div><div class="ttdeci">int http_send(void *conn, char *buffer, const char *uri, int method)</div><div class="ttdoc">Write a PUT or POST request message to a buffer and queue the request. </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00370">http.c:370</a></div></div>
<div class="ttc" id="group__http__connection_html_ga588ce3ea3e16dab03a96b65b9d58d0dc"><div class="ttname"><a href="group__http__connection.html#ga588ce3ea3e16dab03a96b65b9d58d0dc">http_method</a></div><div class="ttdeci">int http_method(void *conn)</div><div class="ttdoc">Return the method associated with the HTTP response. </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00297">http.c:297</a></div></div>
<div class="ttc" id="group__http__connection_html_ga1aeb6fb256def5da05c835071e41dfa0"><div class="ttname"><a href="group__http__connection.html#ga1aeb6fb256def5da05c835071e41dfa0">http_allow</a></div><div class="ttdeci">void http_allow(void *conn, const char *allow)</div><div class="ttdoc">Send HTTP response, status 405 (Method Not Allowed). </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00407">http.c:407</a></div></div>
<div class="ttc" id="group__http__connection_html_gaf3fe661f3848c3ce13c987c4f3f72ffb"><div class="ttname"><a href="group__http__connection.html#gaf3fe661f3848c3ce13c987c4f3f72ffb">http_init</a></div><div class="ttdeci">void http_init(void *conn, int client, const char *accept, const char *media)</div><div class="ttdoc">Initialize an HTTP connection. </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00309">http.c:309</a></div></div>
<div class="ttc" id="group__tcp_html_ga4e3db9ca684fe6b75e37dae88f3aeac4"><div class="ttname"><a href="group__tcp.html#ga4e3db9ca684fe6b75e37dae88f3aeac4">tcp_status</a></div><div class="ttdeci">int tcp_status(void *port)</div><div class="ttdoc">Return the status of the TcpPort. </div></div>
<div class="ttc" id="group__http__connection_html_ga83590f08e1aeaaa81b2873583ce99dd2"><div class="ttname"><a href="group__http__connection.html#ga83590f08e1aeaaa81b2873583ce99dd2">http_close</a></div><div class="ttdeci">void http_close(void *conn)</div><div class="ttdoc">Close the HTTP connection and free queued requests/data. </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00381">http.c:381</a></div></div>
<div class="ttc" id="group__http__connection_html_gac4613339c6810e44f79f8c4942ae9f6c"><div class="ttname"><a href="group__http__connection.html#gac4613339c6810e44f79f8c4942ae9f6c">http_error</a></div><div class="ttdeci">void http_error(void *conn, int status)</div><div class="ttdoc">Send HTTP response with status and close connection. </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00435">http.c:435</a></div></div>
<div class="ttc" id="group__http__connection_html_ga5150a5e062ed872568f6666ce8859baa"><div class="ttname"><a href="group__http__connection.html#ga5150a5e062ed872568f6666ce8859baa">http_rebuffer</a></div><div class="ttdeci">void http_rebuffer(void *conn, char *data)</div><div class="ttdoc">Clear data up to the pointer and read more data from the connection. </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00473">http.c:473</a></div></div>
<div class="ttc" id="structQueue_html"><div class="ttname"><a href="structQueue.html">Queue</a></div><div class="ttdoc">Queue structure. </div><div class="ttdef"><b>Definition:</b> <a href="queue_8c_source.html#l00006">queue.c:6</a></div></div>
<div class="ttc" id="group__http__connection_html_ga6d911522875a4b99a4172e4a02b78a8a"><div class="ttname"><a href="group__http__connection.html#ga6d911522875a4b99a4172e4a02b78a8a">http_get</a></div><div class="ttdeci">void http_get(void *conn, const char *uri)</div><div class="ttdoc">Perform a GET request immediately if possible or queue for later. </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00357">http.c:357</a></div></div>
<div class="ttc" id="group__connection_html_gada463d4dd44545e50cd269a5c363787d"><div class="ttname"><a href="group__connection.html#gada463d4dd44545e50cd269a5c363787d">conn_close</a></div><div class="ttdeci">void conn_close(void *conn)</div><div class="ttdoc">Close a Connection. </div><div class="ttdef"><b>Definition:</b> <a href="connection_8c_source.html#l00118">connection.c:118</a></div></div>
<div class="ttc" id="group__http__connection_html_gaf4fb8bd1fa38b29e340be73efac05a40"><div class="ttname"><a href="group__http__connection.html#gaf4fb8bd1fa38b29e340be73efac05a40">http_location</a></div><div class="ttdeci">char * http_location(void *conn)</div><div class="ttdoc">Get the Location header value. </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00302">http.c:302</a></div></div>
<div class="ttc" id="group__http__connection_html_ga81402c76a79e0fdf3f0fb8d4c9ba52e9"><div class="ttname"><a href="group__http__connection.html#ga81402c76a79e0fdf3f0fb8d4c9ba52e9">http_created</a></div><div class="ttdeci">void http_created(void *conn, const char *uri)</div><div class="ttdoc">Send an HTTP response with status 201 (Created). </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00395">http.c:395</a></div></div>
<div class="ttc" id="group__http__connection_html_gaa36a00e63b21d521263da96cadd3ec44"><div class="ttname"><a href="group__http__connection.html#gaa36a00e63b21d521263da96cadd3ec44">set_content_length</a></div><div class="ttdeci">void set_content_length(char *buffer, int length)</div><div class="ttdoc">Update the Content-Length header. </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00376">http.c:376</a></div></div>
<div class="ttc" id="group__connection_html_gae63df32b30da421837e2c67cfacc3497"><div class="ttname"><a href="group__connection.html#gae63df32b30da421837e2c67cfacc3497">conn_write</a></div><div class="ttdeci">int conn_write(void *conn, const char *data, int length)</div><div class="ttdoc">Write data to a Connection. </div><div class="ttdef"><b>Definition:</b> <a href="connection_8c_source.html#l00114">connection.c:114</a></div></div>
<div class="ttc" id="group__http__connection_html_ga8573192ee45dd0e3a5111bab62e03e44"><div class="ttname"><a href="group__http__connection.html#ga8573192ee45dd0e3a5111bab62e03e44">http_receive</a></div><div class="ttdeci">int http_receive(void *conn)</div><div class="ttdoc">Receive an HTTP request/response. </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00507">http.c:507</a></div></div>
<div class="ttc" id="group__http__connection_html_gaa760070967803d689c4dd0fc407ff563"><div class="ttname"><a href="group__http__connection.html#gaa760070967803d689c4dd0fc407ff563">http_respond</a></div><div class="ttdeci">void http_respond(void *conn, int status)</div><div class="ttdoc">Send an HTTP response with status. </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00427">http.c:427</a></div></div>
<div class="ttc" id="group__http__connection_html_ga48e49b5c445099537f9b9b4ae89fa8df"><div class="ttname"><a href="group__http__connection.html#ga48e49b5c445099537f9b9b4ae89fa8df">http_no_content</a></div><div class="ttdeci">void http_no_content(void *conn, const char *uri)</div><div class="ttdoc">Send HTTP response with status 204 (No Content). </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00401">http.c:401</a></div></div>
<div class="ttc" id="group__http__connection_html_ga08146812d01ea110926efc6dbf39b91d"><div class="ttname"><a href="group__http__connection.html#ga08146812d01ea110926efc6dbf39b91d">http_parse_uri</a></div><div class="ttdeci">int http_parse_uri(Uri *uri, void *conn, const char *href)</div><div class="ttdoc">Parse an HTTP URI using connection parameters. </div><div class="ttdef"><b>Definition:</b> <a href="http__parse_8c_source.html#l00122">http_parse.c:122</a></div></div>
<div class="ttc" id="group__http__connection_html_ga5e069d5d6ad16d184f959507c7e3bea8"><div class="ttname"><a href="group__http__connection.html#ga5e069d5d6ad16d184f959507c7e3bea8">http_range</a></div><div class="ttdeci">char * http_range(void *conn)</div><div class="ttdoc">Get the Accept header value (media range). </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00300">http.c:300</a></div></div>
<div class="ttc" id="group__queue_html_ga3001011f0b018b23ce87b33bbc6438d9"><div class="ttname"><a href="group__queue.html#ga3001011f0b018b23ce87b33bbc6438d9">queue_empty</a></div><div class="ttdeci">#define queue_empty(queue)</div><div class="ttdoc">Test if the queue is empty. </div><div class="ttdef"><b>Definition:</b> <a href="queue_8c_source.html#l00023">queue.c:23</a></div></div>
<div class="ttc" id="group__address_html_ga80f2dcdb3778441e85ac8c9dbb6f324a"><div class="ttname"><a href="group__address.html#ga80f2dcdb3778441e85ac8c9dbb6f324a">Address</a></div><div class="ttdeci">struct _Address Address</div><div class="ttdoc">The Address struture represents an IPv4 or IPv6 address with an associated port. </div><div class="ttdef"><b>Definition:</b> <a href="platform_8c_source.html#l00140">platform.c:140</a></div></div>
<div class="ttc" id="group__queue_html_gaaa24b65f3154f21e3ff86ef0722b5c33"><div class="ttname"><a href="group__queue.html#gaaa24b65f3154f21e3ff86ef0722b5c33">queue_insert</a></div><div class="ttdeci">void queue_insert(Queue *queue, void *item)</div><div class="ttdoc">Insert linked item at the tail of the queue. </div><div class="ttdef"><b>Definition:</b> <a href="queue_8c_source.html#l00051">queue.c:51</a></div></div>
<div class="ttc" id="group__http__connection_html_ga8cf07b868935828ebfe2b80c8b3d135e"><div class="ttname"><a href="group__http__connection.html#ga8cf07b868935828ebfe2b80c8b3d135e">http_path</a></div><div class="ttdeci">char * http_path(void *conn)</div><div class="ttdoc">Get the path for an HTTP request. </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00298">http.c:298</a></div></div>
<div class="ttc" id="group__http__connection_html_ga219c5661faaf31ba853fc7a4f4aaac07"><div class="ttname"><a href="group__http__connection.html#ga219c5661faaf31ba853fc7a4f4aaac07">http_flush</a></div><div class="ttdeci">void http_flush(void *conn)</div><div class="ttdoc">Flush queued data to an HTTP connection. </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00321">http.c:321</a></div></div>
<div class="ttc" id="group__http__connection_html_ga81ef4c524a625b75de614b745300fd45"><div class="ttname"><a href="group__http__connection.html#ga81ef4c524a625b75de614b745300fd45">http_status_line</a></div><div class="ttdeci">int http_status_line(char *buffer, int status, const char *reason)</div><div class="ttdoc">Write an HTTP status line to buffer. </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00388">http.c:388</a></div></div>
<div class="ttc" id="group__http__connection_html_gaab725405e3c788f0b9b72d3a3cc5d2f3"><div class="ttname"><a href="group__http__connection.html#gaab725405e3c788f0b9b72d3a3cc5d2f3">http_status</a></div><div class="ttdeci">int http_status(void *conn)</div><div class="ttdoc">Get status for HTTP response. </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00296">http.c:296</a></div></div>
<div class="ttc" id="group__http__connection_html_gad284834e20a26101fcd6e6751922c92e"><div class="ttname"><a href="group__http__connection.html#gad284834e20a26101fcd6e6751922c92e">http_write</a></div><div class="ttdeci">void http_write(void *conn, void *data, int length)</div><div class="ttdoc">Write data to an HTTP connection immediately if possible or queue for later. </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00329">http.c:329</a></div></div>
<div class="ttc" id="structUri_html"><div class="ttname"><a href="structUri.html">Uri</a></div><div class="ttdef"><b>Definition:</b> <a href="uri_8c_source.html#l00009">uri.c:9</a></div></div>
<div class="ttc" id="group__queue_html_ga42c7cc8caeb6778234887511db8fba40"><div class="ttname"><a href="group__queue.html#ga42c7cc8caeb6778234887511db8fba40">queue_free</a></div><div class="ttdeci">void queue_free(Queue *queue)</div><div class="ttdoc">Free queued items. </div><div class="ttdef"><b>Definition:</b> <a href="queue_8c_source.html#l00064">queue.c:64</a></div></div>
<div class="ttc" id="group__http__connection_html_gae61eeb371ab52758dcdc2e376c32d7c1"><div class="ttname"><a href="group__http__connection.html#gae61eeb371ab52758dcdc2e376c32d7c1">http_query</a></div><div class="ttdeci">char * http_query(void *conn)</div><div class="ttdoc">Get the query for an HTTP request. </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00299">http.c:299</a></div></div>
<div class="ttc" id="group__http__connection_html_gad00b80f2f0573963fb7f6f0227fc748a"><div class="ttname"><a href="group__http__connection.html#gad00b80f2f0573963fb7f6f0227fc748a">http_client</a></div><div class="ttdeci">int http_client(void *conn)</div><div class="ttdoc">Is the HTTP connection a client? </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00301">http.c:301</a></div></div>
<div class="ttc" id="group__tcp_html_gafcf36036563f4bf40b5ec38752b29391"><div class="ttname"><a href="group__tcp.html#gafcf36036563f4bf40b5ec38752b29391">tcp_host</a></div><div class="ttdeci">Address * tcp_host(void *port)</div><div class="ttdoc">Return the Address of the connected TCP host. </div></div>
<div class="ttc" id="group__http__connection_html_ga840e20735c835fbd29956a2d82b5ef71"><div class="ttname"><a href="group__http__connection.html#ga840e20735c835fbd29956a2d82b5ef71">http_complete</a></div><div class="ttdeci">int http_complete(void *conn)</div><div class="ttdoc">Is data from the message body complete? </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00452">http.c:452</a></div></div>
<div class="ttc" id="group__http__connection_html_gaa572f95189ccc118a8fc1d070b76f896"><div class="ttname"><a href="group__http__connection.html#gaa572f95189ccc118a8fc1d070b76f896">http_data</a></div><div class="ttdeci">char * http_data(void *conn, int *length)</div><div class="ttdoc">Return data from the message body. </div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00457">http.c:457</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>http.c</b></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
